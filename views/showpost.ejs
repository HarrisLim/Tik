<!DOCTYPE html>
<html>
	<head>
		<%- include header.ejs %>
		<script>
			<%- include showpost_control.js%>

				function repl(sentence, arr, src, style){
					var rere = sentence.replace(arr, '<img src=' + src + ' style=' + style+ '>')
					$('#tempText').val(rere);
					return sentence.replace(arr, '<img src=' + src + ' style=' + style+ '>');
				};
				
		</script>

		<title>Show post</title>
	</head>
	<body>
		<%#
			var strToMatch = "<img src=\"http://a.jpg\"/> image1<img src='http://b.jpg'/> image2  <img src='http://a.gif'/>";
			var strReg = new RegExp("http://*[^>]*\\.(jpg|gif|png)","gim");
			var xArr =  strToMatch.match(strReg);



			var regexp_src = /\"\/uploads*[^"]*\"/gim;
			var regexp_style= /\"height*[^"]*\"/gim;	

			splitOne[i]


			var getFir = sentence.replace(xArr[0],'??');
			getFir.replace(xArr[1],'??');
		%>

		
			<%
				var sentence = results[0].post;
				var regexp_img = /<img[^>]*src=[\"']?([^>\"']+)[\"']?[^>]*>/gim;
				var regexp_src = /\/uploads*[^"]*/gim;
				var regexp_style= /height*[^"]*/gim;
				var xArr =  sentence.match(regexp_img);
				var src =  sentence.match(regexp_src);
				var style =  sentence.match(regexp_style);%>
				<%if (xArr) {%> <%# if를 하는 이유는 사진이 업로되된 페이지가 아니면 length에러가 나기 때문.%>

				<%
				var leng = xArr.length + xArr.length + 1;
				var splitOne = sentence.split(xArr);

				console.log('leng -> ' + leng);
				console.log('regexp_img -> ' + regexp_img);
				console.log('xArr.length -> ' + xArr.length);
				console.log('xArr-> ' + xArr);
				console.log('src0 -> ' + src[0]);
				console.log('src1 -> ' + src[1]);
				console.log('-------------------------------');
				%>	

			<%# 이 밑에 것으로 그 중간에 위치는 찾았는데 html tag가 안들어가네 %>
			<%for(var j = 0; j < xArr.length; j++) {%>
				<%
				var temp;
				var getF;
				sentence = sentence.replace(xArr[j], '??');%>
				
				<img src="<%=src[j]%>" style="<%=style[j]%>">
			<%}%><br>
			<%=sentence%><br>

			위에 ??에 어떻게 img 태그를 넣어야할까..
		<%}%>
		<%console.log('xArr-> ' + xArr);%>
		<br><br>

------------------------------------------------------------------------------------------
		<%
			var curId = results[0].id;
			var curNickname = results[0].nickname;
			var curInsid = results[0].insid;
			var curCreated_at = results[0].p_created_at;
			var curUpdated_at = results[0].p_updated_at;
			var curTitle = results[0].title;
			var curPicpath = results[0].picpath;
			var curPost = results[0].post;
			var curGetwant = results[0].getwant;
			var curHashTag = results[0].hashtag;
			var curViews = results[0].views;
			var curHowmanydays = results[0].howmanydays;
			var curPostnum = results[0].postnum;
			var curP_MembersId = results[0].members_id;
			var curPostings_postnum = results[0].postings_postnum;
			var writtenTld = results[0].tld;
			var commLeng = 0;
		%>
		<% if(notSign === false) {%>
		<a href="/process/main"><h3>Talk<br>T ik</h3></a> Hi ! <img src="../flags-mini/<%=signTld%>.png"> <%=signNick%>
		<% } else { %>
			<a href="/process/main"><h3>Talk<br>T ik</h3></a>
		<% } %>
		<hr>
		<div class="ui container">
			<div class="ui" style="float:right">
				<% if(notSign === false) { %>
					<% if(curId == curSigninId || signNick === "harrislim") { %> <%# If sign in %>
						<input type="button" value="Edit" onClick="button_edit();">
						<input type="submit" value="Delete : (" onClick="button_delPost();">
						<form method="post" action="/process/deletepost" id="button_delPost"> <input type="hidden" name="postnum" value="<%= curPostnum%>">
						</form>
					<% } else { %>
						<input type="button" value="Delete : (" onClick='alert("you cant delete.")'>
					<% } %>
				<% } else { %>
					<input type="button" value="Delete : (" onClick='alert("you can not delete.")'>
				<% } %>
			</div>
		</div>
		<div class="ui container">
			<div style="text-align:right; padding-top:25px">
				<a class="ui image label">
					Created_Date
					<div class="detail"><%=formatDateHelper(curCreated_at)%></div>
				</a>
				<a class="ui image label">
					Views
					<div class="detail"><%= curViews%></div>
				</a>
			</div>
		</div><br>
		<div class="ui container">
			<h1 style="text-align:center"><%= curTitle%></h1><br>
			<div style="text-align:right">
				<h4><%= curHowmanydays%><br>
				Written by <img src="../flags-mini/<%=writtenTld%>.png"> <%= curNickname%> !</h4>
			</div>
		</div>
		<h3>Post</h3>
		<div class="ui container">
			<div class="ui message">
				<%= curPicpath%><br>
				<%= curPost%>
			</div>
		</div>
		<h3>Hashtag</h3>
		<div class="ui container">
			<%= curHashTag%>
		</div>
		<br>
		<div class="ui labeled button" tabindex="0">
			<div class="ui blue button">
				<i class="plane icon"></i> I wanna go
			</div>
			<a class="ui basic blue left pointing label">
			<%=curGetwant%>
			</a>
		</div>
		<h3>Instagram</h3>
		<div class="ui container">
			<label><a href="https://www.instagram.com/<%=curInsid%>" target="_blank"><i class="instagram icon"></i> <%= curInsid %></a></label>
		</div>
		<p>
		<hr>
		<br>
		<%- include showpost_comment.ejs%>
	</body>
</html>